<%- include('partials/header.ejs') %>

<div class="main-panel">
  <div class="content-wrapper pb-0">
    <div class="page-header flex-wrap">
      <h3 class="mb-0">
        Hi <%= (user && (user.username || user.name)) ? (user.username || user.name) : 'Guest' %>, welcome back!
        <span class="ps-0 h6 ps-sm-2 text-muted d-inline-block">Your web recipe book!</span>
      </h3>
      <div class="d-flex">
        <a href="/recipe/add" class="btn btn-sm ms-3 btn-success">Add Recipe</a>
      </div>
    </div>

    <!-- Recipes Section -->
    <div class="row mt-4">
      <% if (recipes && recipes.length > 0) { %>
        <% recipes.forEach(recipe => { %>
          <div class="col-md-4 grid-margin stretch-card">
            <div class="card shadow-sm recipe-card" style="cursor: pointer;" onclick="window.location.href='/recipe/<%= recipe._id %>'">
              
              <!-- Recipe Image -->
              <% if (recipe.image) { %>
                <img src="<%= recipe.image %>" class="card-img-top" alt="<%= recipe.name %>" style="height: 200px; object-fit: cover;">
              <% } else { %>
                <img src="/images/placeholder-food.jpg" class="card-img-top" alt="No image" style="height: 200px; object-fit: cover;">
              <% } %>

              <!-- Card Body -->
              <div class="card-body">
                <h4 class="card-title mb-2"><%= recipe.name %></h4>
                <p class="text-muted mb-2">
                  <i class="mdi mdi-clock-outline"></i> <%= recipe.time %> mins
                </p>
                <% if (recipe.cuisine) { %>
                  <span class="badge bg-primary text-white mb-2"><%= recipe.cuisine %></span>
                <% } %>
                <p class="card-text text-truncate" style="max-height: 60px; overflow: hidden;">
                  <%= recipe.description %>
                </p>
              </div>

              <!-- Footer -->
              <div class="card-footer bg-light d-flex justify-content-between align-items-center">
                <small class="text-muted">By <%= recipe.author ? (recipe.author.username || recipe.author.name || 'Unknown') : 'Unknown' %></small>
                <a href="/recipe/<%= recipe._id %>" class="btn btn-outline-primary btn-sm">View</a>
              </div>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="col-12 text-center mt-5">
          <h5 class="text-muted">No recipes found yet.</h5>
          <a href="/recipe/add" class="btn btn-success mt-3">Add Your First Recipe</a>
        </div>
      <% } %>
    </div>
  </div>
</div>

<%- include('partials/footer.ejs') %>

<style>
  .recipe-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .recipe-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  }
</style>
